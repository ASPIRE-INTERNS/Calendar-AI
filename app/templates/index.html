<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ month }} {{ year }} Calendar</title>    
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

</script>
<body>
    <header>
        <h1>Calendar</h1>
    </header>

    <div class="main-container">
        <div class="calendar-section">
            <h2>{{ month }} {{ year }}</h2>
            <div class="navigation">
                <a href="{{ url_for('main.calendar_view', year=current_year, month=current_month - 1) }}">&#8592; Previous</a>
            
                <div class="jump-container">
                    <select id="jumpMonth">
                        <option value="1">Jan</option>
                        <option value="2">Feb</option>
                        <option value="3">Mar</option>
                        <option value="4">Apr</option>
                        <option value="5">May</option>
                        <option value="6">Jun</option>
                        <option value="7">Jul</option>
                        <option value="8">Aug</option>
                        <option value="9">Sep</option>
                        <option value="10">Oct</option>
                        <option value="11">Nov</option>
                        <option value="12">Dec</option>
                    </select>
            
                    <input type="number" id="jumpYear" placeholder="Year">
                    <button id="jumpButton">Go</button>
                </div>
            
                <a href="{{ url_for('main.calendar_view', year=current_year, month=current_month + 1) }}">Next &#8594;</a>
            </div>
            
            <div class="add-container">
                <button id="addButton">
                    <i class="fas fa-plus" style="color: white;"></i>
                </button>
                <div id="addOptions">
                    <div class="option" data-type="event">Event</div>
                    <div class="option" data-type="reminder">Reminder</div>
                    <div class="option" data-type="task">Task</div>
                </div>
            </div>    
            
            <!-- Placeholder for Form -->
            <div id="formPopup" class="hidden">
                <form id="eventForm">
                    <h2 id="formTitle">Add Item</h2>
                
                    <input type="text" id="title" placeholder="Title" required><br>
                
                    <textarea id="description" placeholder="Description"></textarea><br>
                
                    <input type="date" id="eventDate" required><br>
                
                    <input type="time" id="eventTime" required><br>
                
                    <select id="recurrence">
                        <option value="none">No Recurrence</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="yearly">Yearly</option>
                    </select><br>
                
                    <button type="submit">Save</button>
                    <button type="button" onclick="closeForm()">Cancel</button>
                </form>
            </div>    
            
            <div class="calendar" id="calendarContainer">
                <!-- Week Days -->
                <div class="day-name">Mon</div>
                <div class="day-name">Tue</div>
                <div class="day-name">Wed</div>
                <div class="day-name">Thu</div>
                <div class="day-name">Fri</div>
                <div class="day-name">Sat</div>
                <div class="day-name">Sun</div>
                <!-- Calendar Days -->
                {% for week in calendar %}
                    {% for day in week %}
                        {% if day == 0 %}
                            <div class="day empty"></div>
                        {% elif day == highlight_day %}
                            <div class="day today" id="day-{{ day }}">
                                {{ day }}
                                <div class="event-icons" id="event-icons-{{ day }}"></div>
                            </div>
                        {% else %}
                            <div class="day" id="day-{{ day }}">
                                {{ day }}
                                <div class="event-icons" id="event-icons-{{ day }}"></div>
                            </div>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </div>
            
            <h2 id="yourEventsHeading" style="display: none;">Your Events</h2>
            <div id="eventList"></div>
        </div>

        <!-- Did You Know Section -->
        <div class="did-you-know-section">
            <div class="did-you-know-card">
                <h3>Did You Know?</h3>
                <div id="daily-fact" class="daily-fact">
                    {% if daily_fact %}
                        {{ daily_fact }}
                    {% else %}
                        Loading...
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="logout-container">
        <a href="{{ url_for('auth.change_password') }}" class="btn btn-secondary">
            <i class="fas fa-key"></i> Change Password
        </a>
        <a href="{{ url_for('auth.logout') }}" class="logout-button">
            <i class="fas fa-sign-out-alt"></i>
            Logout
        </a>
    </div>
    
    <div class="button-container">
        <!-- Chatbot Button -->
        <button id="chatbotButton" class="chatbot-button">
            <i class="fas fa-comment-alt"></i>
        </button>

        <!-- Chatbot Dropdown -->
        <div id="chatbotDropdown" class="hidden">
            <div class="chatbot-header">
                <h3>Calendar Assistant</h3>
                <button id="closeChatbot">&times;</button>
            </div>
            <div id="chatArea"></div>
            <div class="chatbot-input">
                <input type="text" id="userMessage" autocomplete="off">
                <button id="sendMessageButton">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    
    <style>
    .main-container {
        display: flex;
        gap: 30px;
        padding: 20px;
        max-width: 1600px;
        margin: 0 auto;
        position: relative;
    }

    .calendar-section {
        flex: 1;
        min-width: 800px;
    }

    .did-you-know-section {
        width: 400px;
        position: sticky;
        top: 20px;
        height: fit-content;
    }

    .did-you-know-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        padding: 20px;
        margin-top: 20px;
    }

    .did-you-know-card h3 {
        margin: 0 0 15px 0;
        color: #2c3e50;
        font-size: 1.4em;
        font-weight: 600;
    }

    .daily-fact {
        font-size: 1.2em;
        line-height: 1.6;
        color: #2c3e50;
        padding: 20px;
        background-color: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #007bff;
    }

    /* Ensure calendar maintains its size */
    .calendar {
        width: 100%;
        min-width: 800px;
    }

    .day {
        min-height: 50px;
        padding: 5px;
        font-size: 0.9em;
    }

    .day-name {
        font-size: 0.9em;
    }

    .event-icons {
        font-size: 0.8em;
    }
    </style>

    <script>
    // Add this to your existing JavaScript
    function updateDailyFact() {
        fetch('/get_daily_fact')
            .then(response => response.json())
            .then(data => {
                if (data.fact) {
                    document.getElementById('daily-fact').textContent = data.fact;
                }
            })
            .catch(error => console.error('Error fetching daily fact:', error));
    }

    // Update the fact every hour
    setInterval(updateDailyFact, 3600000);
    </script>
</body>
</html>
